<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Note-Taking App</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Cedarville+Cursive&family=Indie+Flower&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            overflow: hidden;
        }

        .app-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        .toolbar {
            background-color: #333;
            padding: 10px;
            display: flex;
            align-items: center;
            justify-content: flex-start;
            gap: 15px;
        }

        .tool-btn {
            background-color: #555;
            color: white;
            border: none;
            border-radius: 5px;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .tool-btn:hover {
            background-color: #777;
        }

        .tool-btn.active {
            background-color: #4a7dff;
        }

        .save-btn {
            margin-left: auto;
        }

        .canvas-area {
            flex: 1;
            background-color: #000;
            position: relative;
            overflow: hidden;
        }

        .star {
            position: absolute;
            background-color: white;
            width: 2px;
            height: 2px;
            border-radius: 50%;
        }

        .text-input {
            position: absolute;
            background-color: rgba(0, 0, 0, 0.7);
            border: 1px solid #666;
            color: white;
            padding: 8px;
            width: 300px;
            z-index: 100;
        }

        .color-picker {
            position: absolute;
            background-color: #333;
            padding: 10px;
            border-radius: 5px;
            display: flex;
            gap: 10px;
            z-index: 100;
        }

        .color-option {
            width: 25px;
            height: 25px;
            border-radius: 50%;
            cursor: pointer;
            border: 1px solid white;
        }

        .content-item {
            position: absolute;
            max-width: 300px;
            word-wrap: break-word;
            cursor: default;
        }

        .selected {
            outline: 2px dashed white;
        }

        .main-heading {
            font-family: 'Cedarville Cursive', cursive;
            font-size: 28px;
            font-weight: bold;
            color: white;
            text-align: center;
        }

        .side-heading {
            font-family: 'Cedarville Cursive', cursive;
            font-size: 20px;
            font-weight: bold;
            color: white;
        }

        .normal-text {
            font-family: 'Indie Flower', cursive;
            font-size: 16px;
            color: white;
        }

        .drawing-path {
            position: absolute;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="toolbar">
            <button class="tool-btn active" id="pen-tool" title="Pen Tool">
                <i class="fas fa-pen"></i>
            </button>
            <button class="tool-btn" id="text-tool" title="Text Tool">
                <i class="fas fa-font"></i>
            </button>
            <button class="tool-btn" id="select-tool" title="Select Tool">
                <i class="fas fa-mouse-pointer"></i>
            </button>
            <button class="tool-btn" id="eraser-tool" title="Eraser Tool">
                <i class="fas fa-eraser"></i>
            </button>
            <button class="tool-btn" id="image-tool" title="Insert Image">
                <i class="fas fa-image"></i>
            </button>
            <button class="tool-btn save-btn" id="save-tool" title="Save as PDF">
                <i class="fas fa-save"></i>
            </button>
        </div>
        <div class="canvas-area" id="canvas">
            <!-- Stars will be generated by JavaScript -->
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // DOM Elements
            const canvas = document.getElementById('canvas');
            const penTool = document.getElementById('pen-tool');
            const textTool = document.getElementById('text-tool');
            const selectTool = document.getElementById('select-tool');
            const eraserTool = document.getElementById('eraser-tool');
            const imageTool = document.getElementById('image-tool');
            const saveTool = document.getElementById('save-tool');
            
            // State
            let currentTool = 'pen';
            let isDrawing = false;
            let currentColor = '#ffffff';
            let currentPath = null;
            let pathPoints = [];
            let selectedItem = null;
            let contentItems = [];
            let startX, startY;
            let moveOffsetX, moveOffsetY;
            let longPressTimeout = null;
            let drawingId = 0;
            
            // Available colors
            const colors = ['#ff0000', '#0000ff', '#ffff00', '#800080', '#00ff00'];
            
            // Create stars in the background
            createStars();
            
            // Set up event listeners
            setupEventListeners();
            
            function createStars() {
                const numStars = 200;
                for (let i = 0; i < numStars; i++) {
                    const star = document.createElement('div');
                    star.classList.add('star');
                    star.style.left = `${Math.random() * 100}%`;
                    star.style.top = `${Math.random() * 100}%`;
                    star.style.opacity = (Math.random() * 0.7) + 0.3;
                    canvas.appendChild(star);
                }
            }
            
            function setupEventListeners() {
                // Tool selection
                penTool.addEventListener('click', () => setActiveTool('pen'));
                textTool.addEventListener('click', () => setActiveTool('text'));
                selectTool.addEventListener('click', () => setActiveTool('select'));
                eraserTool.addEventListener('click', () => setActiveTool('eraser'));
                imageTool.addEventListener('click', handleImageTool);
                saveTool.addEventListener('click', handleSavePDF);
                
                // Canvas events
                canvas.addEventListener('mousedown', handleCanvasMouseDown);
                canvas.addEventListener('mousemove', handleCanvasMouseMove);
                canvas.addEventListener('mouseup', handleCanvasMouseUp);
                canvas.addEventListener('mouseleave', handleCanvasMouseUp);
            }
            
            function setActiveTool(tool) {
                currentTool = tool;
                
                // Update UI
                document.querySelectorAll('.tool-btn').forEach(btn => btn.classList.remove('active'));
                document.getElementById(`${tool}-tool`).classList.add('active');
                
                // Reset state
                clearColorPicker();
                removeTextInput();
                
                // Deselect any selected item
                if (selectedItem !== null) {
                    document.getElementById(`content-${selectedItem}`).classList.remove('selected');
                    selectedItem = null;
                }
                
                // Change cursor based on tool
                switch(tool) {
                    case 'pen':
                        canvas.style.cursor = 'crosshair';
                        break;
                    case 'text':
                        canvas.style.cursor = 'text';
                        break;
                    case 'select':
                        canvas.style.cursor = 'default';
                        break;
                    case 'eraser':
                        canvas.style.cursor = 'not-allowed';
                        break;
                    default:
                        canvas.style.cursor = 'default';
                }
            }
            
            function handleCanvasMouseDown(e) {
                const rect = canvas.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                
                startX = x;
                startY = y;
                
                switch(currentTool) {
                    case 'pen':
                        isDrawing = true;
                        pathPoints = [{x, y}];
                        startDrawing(x, y);
                        
                        // Set up long press for color picker
                        longPressTimeout = setTimeout(() => {
                            showColorPicker(x, y);
                        }, 500);
                        break;
                        
                    case 'text':
                        createTextInput(x, y);
                        break;
                        
                    case 'select':
                        // Check if clicked on any content item
                        const clickedItem = findClickedItem(x, y);
                        if (clickedItem !== null) {
                            if (selectedItem !== null) {
                                document.getElementById(`content-${selectedItem}`).classList.remove('selected');
                            }
                            
                            selectedItem = clickedItem;
                            document.getElementById(`content-${selectedItem}`).classList.add('selected');
                            
                            // Calculate offset for moving
                            const item = contentItems[selectedItem];
                            moveOffsetX = x - item.x;
                            moveOffsetY = y - item.y;
                        } else {
                            // Clicked on empty space, deselect
                            if (selectedItem !== null) {
                                document.getElementById(`content-${selectedItem}`).classList.remove('selected');
                                selectedItem = null;
                            }
                        }
                        break;
                        
                    case 'eraser':
                        if (selectedItem !== null) {
                            // Remove the selected item
                            document.getElementById(`content-${selectedItem}`).remove();
                            contentItems.splice(selectedItem, 1);
                            selectedItem = null;
                            
                            // Update IDs of remaining elements
                            updateContentItemIds();
                        }
                        break;
                }
            }
            
            function handleCanvasMouseMove(e) {
                if (!isDrawing && selectedItem === null) return;
                
                const rect = canvas.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                
                if (isDrawing && currentTool === 'pen') {
                    // Add point to current path
                    pathPoints.push({x, y});
                    updateDrawingPath();
                } else if (selectedItem !== null && currentTool === 'select') {
                    // Move the selected item
                    const newX = x - moveOffsetX;
                    const newY = y - moveOffsetY;
                    
                    const element = document.getElementById(`content-${selectedItem}`);
                    element.style.left = `${newX}px`;
                    element.style.top = `${newY}px`;
                    
                    // Update item position in state
                    contentItems[selectedItem].x = newX;
                    contentItems[selectedItem].y = newY;
                }
            }
            
            function handleCanvasMouseUp() {
                if (isDrawing && currentTool === 'pen') {
                    isDrawing = false;
                    finalizeDrawing();
                }
                
                // Clear long press timeout
                if (longPressTimeout) {
                    clearTimeout(longPressTimeout);
                    longPressTimeout = null;
                }
            }
            
            function startDrawing(x, y) {
                currentPath = document.createElementNS("http://www.w3.org/2000/svg", "svg");
                currentPath.classList.add('drawing-path');
                currentPath.setAttribute('width', '100%');
                currentPath.setAttribute('height', '100%');
                currentPath.style.position = 'absolute';
                currentPath.style.left = '0';
                currentPath.style.top = '0';
                currentPath.style.pointerEvents = 'none';
                
                const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
                path.setAttribute('stroke', currentColor);
                path.setAttribute('stroke-width', '2');
                path.setAttribute('fill', 'none');
                path.setAttribute('d', `M ${x} ${y}`);
                
                currentPath.appendChild(path);
                canvas.appendChild(currentPath);
            }
            
            function updateDrawingPath() {
                if (!currentPath) return;
                
                const path = currentPath.querySelector('path');
                let d = `M ${pathPoints[0].x} ${pathPoints[0].y}`;
                
                for (let i = 1; i < pathPoints.length; i++) {
                    d += ` L ${pathPoints[i].x} ${pathPoints[i].y}`;
                }
                
                path.setAttribute('d', d);
            }
            
            function finalizeDrawing() {
                if (pathPoints.length < 2) {
                    // Remove single-point paths
                    if (currentPath) currentPath.remove();
                    currentPath = null;
                    return;
                }
                
                // Add to content items
                const id = contentItems.length;
                contentItems.push({
                    type: 'drawing',
                    id: `drawing-${drawingId++}`,
                    path: pathPoints,
                    color: currentColor,
                    x: Math.min(...pathPoints.map(p => p.x)),
                    y: Math.min(...pathPoints.map(p => p.y))
                });
                
                // Set ID for the path for later selection
                currentPath.id = `content-${id}`;
                currentPath = null;
            }
            
            function showColorPicker(x, y) {
                clearColorPicker();
                
                const colorPicker = document.createElement('div');
                colorPicker.classList.add('color-picker');
                colorPicker.style.left = `${x}px`;
                colorPicker.style.top = `${y}px`;
                
                colors.forEach(color => {
                    const option = document.createElement('div');
                    option.classList.add('color-option');
                    option.style.backgroundColor = color;
                    option.addEventListener('click', () => {
                        currentColor = color;
                        clearColorPicker();
                    });
                    colorPicker.appendChild(option);
                });
                
                canvas.appendChild(colorPicker);
            }
            
            function clearColorPicker() {
                const existingPicker = document.querySelector('.color-picker');
                if (existingPicker) existingPicker.remove();
            }
            
            function createTextInput(x, y) {
                removeTextInput();
                
                const textInput = document.createElement('input');
                textInput.type = 'text';
                textInput.classList.add('text-input');
                textInput.style.left = `${x}px`;
                textInput.style.top = `${y}px`;
                textInput.placeholder = 'Type text here... Use **[text]** for main heading or *[text]* for side heading';
                
                textInput.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter') {
                        const text = textInput.value.trim();
                        if (text) {
                            addTextContent(text, x, y);
                        }
                        removeTextInput();
                    } else if (e.key === 'Escape') {
                        removeTextInput();
                    }
                });
                
                canvas.appendChild(textInput);
                textInput.focus();
            }
            
            function removeTextInput() {
                const existingInput = document.querySelector('.text-input');
                if (existingInput) existingInput.remove();
            }
            
            function addTextContent(text, x, y) {
                const id = contentItems.length;
                const contentItem = document.createElement('div');
                contentItem.classList.add('content-item');
                contentItem.id = `content-${id}`;
                contentItem.style.left = `${x}px`;
                contentItem.style.top = `${y}px`;
                
                // Process formatting
                let className, formattedText, color;
                
                if (text.match(/\*\*\[(.*?)\]\*\*/)) {
                    // Main heading
                    className = 'main-heading';
                    formattedText = text.match(/\*\*\[(.*?)\]\*\*/)[1];
                } else if (text.match(/\*\[(.*?)\]\*/)) {
                    // Side heading
                    className = 'side-heading';
                    formattedText = text.match(/\*\[(.*?)\]\*/)[1];
                } else {
                    // Normal text
                    className = 'normal-text';
                    formattedText = text;
                    color = colors[Math.floor(Math.random() * colors.length)];
                }
                
                contentItem.classList.add(className);
                contentItem.textContent = formattedText;
                
                if (color) {
                    contentItem.style.color = color;
                }
                
                canvas.appendChild(contentItem);
                
                // Add to content items
                contentItems.push({
                    type: 'text',
                    content: text,
                    formattedText,
                    class: className,
                    color,
                    x,
                    y
                });
            }
            
            function findClickedItem(x, y) {
                for (let i = contentItems.length - 1; i >= 0; i--) {
                    const item = contentItems[i];
                    const element = document.getElementById(`content-${i}`);
                    
                    if (!element) continue;
                    
                    const rect = element.getBoundingClientRect();
                    const canvasRect = canvas.getBoundingClientRect();
                    
                    // Adjust coordinates relative to canvas
                    const adjustedRect = {
                        left: rect.left - canvasRect.left,
                        top: rect.top - canvasRect.top,
                        right: rect.right - canvasRect.left,
                        bottom: rect.bottom - canvasRect.top
                    };
                    
                    if (x >= adjustedRect.left && x <= adjustedRect.right && 
                        y >= adjustedRect.top && y <= adjustedRect.bottom) {
                        return i;
                    }
                }
                
                return null;
            }
            
            function updateContentItemIds() {
                contentItems.forEach((item, index) => {
                    const element = document.getElementById(`content-${index}`);
                    if (element) {
                        element.id = `content-${index}`;
                    }
                });
            }
            
            function handleImageTool() {
                alert('Image insertion would be implemented here in a real application.');
                // In a real implementation, this would open a file picker
                // and handle image uploads
            }
            
            function handleSavePDF() {
                alert('Saving as PDF would be implemented here in a real application.');
                // In a real implementation, this would convert the canvas
                // and all content to a PDF file and prompt a download
            }
        });
    </script>
</body>
</html>
